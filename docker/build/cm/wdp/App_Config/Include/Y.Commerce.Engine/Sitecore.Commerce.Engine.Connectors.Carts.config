<configuration xmlns:patch="http://www.sitecore.net/xmlconfig/" xmlns:role="http://www.sitecore.net/xmlconfig/role/">
  <sitecore role:require="Standalone or ContentDelivery or ContentManagement">
    <commerce.Entities>
      <Cart>
        <patch:attribute name="type">Sitecore.Commerce.Engine.Connect.Entities.CommerceCart, Sitecore.Commerce.Engine.Connect</patch:attribute>
      </Cart>
      <CartLine>
        <patch:attribute name="type">Sitecore.Commerce.Engine.Connect.Entities.CommerceCartLine, Sitecore.Commerce.Engine.Connect</patch:attribute>
      </CartLine>
      <CartProduct>
        <patch:attribute name="type">Sitecore.Commerce.Engine.Connect.Entities.CommerceCartProduct, Sitecore.Commerce.Engine.Connect</patch:attribute>
      </CartProduct>
      <CommerceOrderForm type="Sitecore.Commerce.Engine.Connect.Entities.CommerceOrderForm, Sitecore.Commerce.Engine.Connect" />
      <CommercePromoCodeRecord type="Sitecore.Commerce.Engine.Connect.Entities.CommercePromoCodeRecord, Sitecore.Commerce.Engine.Connect" />
      <Total>
        <patch:attribute name="type">Sitecore.Commerce.Engine.Connect.Entities.CommerceTotal, Sitecore.Commerce.Engine.Connect</patch:attribute>
      </Total>
      <Price>
        <patch:attribute name="type">Sitecore.Commerce.Engine.Connect.Entities.CommercePrice, Sitecore.Commerce.Engine.Connect</patch:attribute>
      </Price>
      <ShippingInfo>
        <patch:attribute name="type">Sitecore.Commerce.Engine.Connect.Entities.CommerceShippingInfo, Sitecore.Commerce.Engine.Connect</patch:attribute>
      </ShippingInfo>
      <FreeGiftSelection type="Sitecore.Commerce.Engine.Connect.Entities.FreeGiftSelection, Sitecore.Commerce.Engine.Connect"/>
      <FreeGiftItem type="Sitecore.Commerce.Engine.Connect.Entities.FreeGiftItem, Sitecore.Commerce.Engine.Connect"/>
      <ItemAvailability type="Sitecore.Commerce.Engine.Connect.Entities.ItemAvailability, Sitecore.Commerce.Engine.Connect"/>
      <ItemPricing type="Sitecore.Commerce.Engine.Connect.Entities.ItemPricing, Sitecore.Commerce.Engine.Connect"/>
      <VariationPricing type="Sitecore.Commerce.Engine.Connect.Entities.VariationPricing, Sitecore.Commerce.Engine.Connect"/>
    </commerce.Entities>

    <pipelines>
      <translate.cartLineToEntity>
        <processor type="Sitecore.Commerce.Engine.Connect.Pipelines.Carts.TranslateCartLineToEntity, Sitecore.Commerce.Engine.Connect">
          <param ref="entityFactory" />
        </processor>
      </translate.cartLineToEntity>

      <translate.cartToEntity>
        <processor type="Sitecore.Commerce.Engine.Connect.Pipelines.Carts.TranslateCartToEntity, Sitecore.Commerce.Engine.Connect">
          <param ref="entityFactory" />
        </processor>
      </translate.cartToEntity>

      <commerce.carts.lockCart>
        <processor type="Sitecore.Commerce.Pipelines.Carts.LockCart.LockCart, Sitecore.Commerce.Connect.Core">
          <patch:delete />
        </processor>
        <processor type="Sitecore.Commerce.Pipelines.Carts.Common.RunSaveCart, Sitecore.Commerce.Connect.Core">
          <patch:delete />
        </processor>
      </commerce.carts.lockCart>

      <commerce.carts.unlockCart>
        <processor type="Sitecore.Commerce.Pipelines.Carts.UnlockCart.UnlockCart, Sitecore.Commerce.Connect.Core">
          <patch:delete />
        </processor>
        <processor type="Sitecore.Commerce.Pipelines.Carts.Common.RunSaveCart, Sitecore.Commerce.Connect.Core">
          <patch:delete />
        </processor>
      </commerce.carts.unlockCart>

      <commerce.carts.updateCart>
        <processor type="Sitecore.Commerce.Pipelines.Carts.Common.CheckIfLocked, Sitecore.Commerce.Connect.Core">
          <patch:delete />
        </processor>
        <processor type="Sitecore.Commerce.Pipelines.Carts.Common.RunSaveCart, Sitecore.Commerce.Connect.Core">
          <patch:delete />
        </processor>
        <processor type="Sitecore.Commerce.Pipelines.Carts.UpdateCart.UpdateCart, Sitecore.Commerce.Connect.Core">
          <patch:delete />
        </processor>
        <processor patch:before="*[1]" type="Sitecore.Commerce.Engine.Connect.Pipelines.Carts.UpdateCartEmail, Sitecore.Commerce.Engine.Connect" />
      </commerce.carts.updateCart>

      <commerce.carts.loadCart>
        <processor patch:before="processor[@type='Sitecore.Commerce.Pipelines.Carts.Common.RunSaveCart, Sitecore.Commerce.Connect.Core']"
                   type="Sitecore.Commerce.Engine.Connect.Pipelines.Carts.LoadCart, Sitecore.Commerce.Engine.Connect" />
      </commerce.carts.loadCart>

      <commerce.carts.getCarts>
        <processor type="Sitecore.Commerce.Engine.Connect.Pipelines.Carts.GetCarts, Sitecore.Commerce.Engine.Connect" />
      </commerce.carts.getCarts>

      <commerce.carts.deleteCart>
        <processor type="Sitecore.Commerce.Pipelines.Carts.Common.CheckIfLocked, Sitecore.Commerce.Connect.Core">
          <patch:delete />
        </processor>
      </commerce.carts.deleteCart>

      <commerce.carts.addCartLines>
        <processor patch:instead="processor[@type='Sitecore.Commerce.Pipelines.Carts.AddCartLines.AddLinesToCart, Sitecore.Commerce.Connect.Core']"
                   type="Sitecore.Commerce.Engine.Connect.Pipelines.Carts.AddCartLines, Sitecore.Commerce.Engine.Connect">
        </processor>
        <processor type="Sitecore.Commerce.Pipelines.Carts.Common.RunSaveCart, Sitecore.Commerce.Connect.Core">
          <patch:delete />
        </processor>
        <processor type="Sitecore.Commerce.Pipelines.Carts.Common.CheckIfLocked, Sitecore.Commerce.Connect.Core">
          <patch:delete />
        </processor>
      </commerce.carts.addCartLines>

      <commerce.carts.removeCartLines>
        <processor type="Sitecore.Commerce.Pipelines.Carts.Common.CheckIfLocked, Sitecore.Commerce.Connect.Core">
          <patch:delete />
        </processor>
        <processor patch:instead="processor[@type='Sitecore.Commerce.Pipelines.Carts.RemoveCartLines.RemoveLinesFromCart, Sitecore.Commerce.Connect.Core']"
                   type="Sitecore.Commerce.Engine.Connect.Pipelines.Carts.RemoveCartLines, Sitecore.Commerce.Engine.Connect" />
        <processor type="Sitecore.Commerce.Pipelines.Carts.Common.RunSaveCart, Sitecore.Commerce.Connect.Core">
          <patch:delete />
        </processor>
      </commerce.carts.removeCartLines>

      <commerce.carts.updateCartLines>
        <processor type="Sitecore.Commerce.Pipelines.Carts.Common.CheckIfLocked, Sitecore.Commerce.Connect.Core">
          <patch:delete />
        </processor>
        <processor patch:before="processor[@type='Sitecore.Commerce.Pipelines.Carts.Common.RunSaveCart, Sitecore.Commerce.Connect.Core']"
                   type="Sitecore.Commerce.Engine.Connect.Pipelines.Carts.UpdateCartLines, Sitecore.Commerce.Engine.Connect">
          <param desc="Rollup">True</param>
        </processor>
        <processor type="Sitecore.Commerce.Pipelines.Carts.Common.RunSaveCart, Sitecore.Commerce.Connect.Core">
          <patch:delete />
        </processor>
      </commerce.carts.updateCartLines>

      <commerce.carts.addPromoCode>
        <processor patch:after="processor[@type='Sitecore.Commerce.Pipelines.Carts.Common.CheckIfLocked, Sitecore.Commerce.Connect.Core']"
                   type="Sitecore.Commerce.Engine.Connect.Pipelines.Carts.AddPromoCodeToCart, Sitecore.Commerce.Engine.Connect" />
        <processor type="Sitecore.Commerce.Pipelines.Carts.Common.RunSaveCart, Sitecore.Commerce.Connect.Core">
          <patch:delete />
        </processor>
      </commerce.carts.addPromoCode>

      <commerce.carts.removePromoCode>
        <processor patch:after="processor[@type='Sitecore.Commerce.Pipelines.Carts.Common.CheckIfLocked, Sitecore.Commerce.Connect.Core']"
                   type="Sitecore.Commerce.Engine.Connect.Pipelines.Carts.RemovePromoCodeFromCart, Sitecore.Commerce.Engine.Connect" />
        <processor type="Sitecore.Commerce.Pipelines.Carts.Common.RunSaveCart, Sitecore.Commerce.Connect.Core">
          <patch:delete />
        </processor>
      </commerce.carts.removePromoCode>

      <commerce.carts.mergeCart>
        <processor patch:before="processor[@type='Sitecore.Commerce.Pipelines.Carts.Common.RunSaveCart, Sitecore.Commerce.Connect.Core']"
                   type="Sitecore.Commerce.Engine.Connect.Pipelines.Carts.MergeCart, Sitecore.Commerce.Engine.Connect" />
        <processor type="Sitecore.Commerce.Pipelines.Carts.Common.RunSaveCart, Sitecore.Commerce.Connect.Core">
          <patch:delete />
        </processor>
      </commerce.carts.mergeCart>

      <commerce.carts.addParties>
        <processor patch:instead="processor[@type='Sitecore.Commerce.Pipelines.Carts.AddParties.AddPartiesToCart, Sitecore.Commerce.Connect.Core']"
                   type="Sitecore.Commerce.Engine.Connect.Pipelines.Carts.AddPartiesToCart, Sitecore.Commerce.Engine.Connect">
          <param ref="entityFactory" />
        </processor>
        <processor type="Sitecore.Commerce.Pipelines.Carts.Common.CheckIfLocked, Sitecore.Commerce.Connect.Core">
          <patch:delete />
        </processor>
        <processor type="Sitecore.Commerce.Pipelines.Carts.Common.RunSaveCart, Sitecore.Commerce.Connect.Core">
          <patch:delete />
        </processor>
      </commerce.carts.addParties>

      <commerce.carts.removeParties>
        <processor patch:instead="processor[@type='Sitecore.Commerce.Pipelines.Carts.RemoveParties.RemovePartiesFromCart, Sitecore.Commerce.Connect.Core']"
                   type="Sitecore.Commerce.Engine.Connect.Pipelines.Carts.RemovePartiesFromCart, Sitecore.Commerce.Engine.Connect" />
        <processor type="Sitecore.Commerce.Pipelines.Carts.Common.CheckIfLocked, Sitecore.Commerce.Connect.Core">
          <patch:delete />
        </processor>
        <processor type="Sitecore.Commerce.Pipelines.Carts.Common.RunSaveCart, Sitecore.Commerce.Connect.Core">
          <patch:delete />
        </processor>
      </commerce.carts.removeParties>

      <commerce.carts.updateParties>
        <processor patch:instead="processor[@type='Sitecore.Commerce.Pipelines.Carts.UpdateParties.UpdatePartiesInCart, Sitecore.Commerce.Connect.Core']"
                   type="Sitecore.Commerce.Engine.Connect.Pipelines.Carts.UpdatePartiesInCart, Sitecore.Commerce.Engine.Connect" />
        <processor type="Sitecore.Commerce.Pipelines.Carts.Common.CheckIfLocked, Sitecore.Commerce.Connect.Core">
          <patch:delete />
        </processor>
        <processor type="Sitecore.Commerce.Pipelines.Carts.Common.RunSaveCart, Sitecore.Commerce.Connect.Core">
          <patch:delete />
        </processor>
      </commerce.carts.updateParties>

      <commerce.carts.addShippingInfo>
        <processor patch:instead="processor[@type='Sitecore.Commerce.Pipelines.Carts.AddShippingInfo.AddShippingInfoToCart, Sitecore.Commerce.Connect.Core']"
                   type="Sitecore.Commerce.Engine.Connect.Pipelines.Carts.AddShippingInfoToCart, Sitecore.Commerce.Engine.Connect">
          <param ref="entityFactory" />
        </processor>
        <processor type="Sitecore.Commerce.Pipelines.Carts.Common.CheckIfLocked, Sitecore.Commerce.Connect.Core">
          <patch:delete />
        </processor>
        <processor type="Sitecore.Commerce.Pipelines.Carts.Common.RunSaveCart, Sitecore.Commerce.Connect.Core">
          <patch:delete />
        </processor>
      </commerce.carts.addShippingInfo>

      <commerce.carts.removeShippingInfo patch:source="Sitecore.Commerce.Carts.config">
        <processor patch:instead="processor[@type='Sitecore.Commerce.Pipelines.Carts.RemoveShippingInfo.RemoveShippingInfoFromCart, Sitecore.Commerce.Connect.Core']"
                   type="Sitecore.Commerce.Engine.Connect.Pipelines.Carts.RemoveShippingInfoFromCart, Sitecore.Commerce.Engine.Connect">
        </processor>
        <processor type="Sitecore.Commerce.Pipelines.Carts.Common.CheckIfLocked, Sitecore.Commerce.Connect.Core">
          <patch:delete />
        </processor>
        <processor type="Sitecore.Commerce.Pipelines.Carts.Common.RunSaveCart, Sitecore.Commerce.Connect.Core">
          <patch:delete />
        </processor>
      </commerce.carts.removeShippingInfo>

      <commerce.carts.addPaymentInfo>
        <processor patch:instead="processor[@type='Sitecore.Commerce.Pipelines.Carts.AddPaymentInfo.AddPaymentInfoToCart, Sitecore.Commerce.Connect.Core']"
                   type="Sitecore.Commerce.Engine.Connect.Pipelines.Carts.AddPaymentInfoToCart, Sitecore.Commerce.Engine.Connect" />
        <processor type="Sitecore.Commerce.Pipelines.Carts.Common.CheckIfLocked, Sitecore.Commerce.Connect.Core">
          <patch:delete />
        </processor>
        <processor type="Sitecore.Commerce.Pipelines.Carts.Common.RunSaveCart, Sitecore.Commerce.Connect.Core">
          <patch:delete />
        </processor>
      </commerce.carts.addPaymentInfo>

      <commerce.carts.removePaymentInfo>
        <processor patch:instead="processor[@type='Sitecore.Commerce.Pipelines.Carts.AddPaymentInfo.AddPaymentInfoToCart, Sitecore.Commerce.Connect.Core']"
                   type="Sitecore.Commerce.Engine.Connect.Pipelines.Carts.RemovePaymentInfoFromCart, Sitecore.Commerce.Engine.Connect" />
        <processor type="Sitecore.Commerce.Pipelines.Carts.Common.CheckIfLocked, Sitecore.Commerce.Connect.Core">
          <patch:delete />
        </processor>
        <processor type="Sitecore.Commerce.Pipelines.Carts.Common.RunSaveCart, Sitecore.Commerce.Connect.Core">
          <patch:delete />
        </processor>
      </commerce.carts.removePaymentInfo>
    </pipelines>
  </sitecore>
</configuration>
